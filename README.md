# UI Email Builder CMS

This repo contains the entirety of the Email Builder CMS.

## Development

### Requirements

Before beginning, make sure you have NodeJS v18 or higher installed.

### Running the Development Server

To work on this project on your local machine:

1. Clone the repo with `git clone git@github.com:newjersey/ui-email-builder-cms.git`
2. Install dependencies with `npm install`
3. Run the development server with `npm run development`
4. Visit `localhost:8000/` to visit the homepage and `localhost:8000/admin` to visit the admin interface

### Using Decap Locally

The following is adapted from [the docs](https://decapcms.org/docs/beta-features/#working-with-a-local-git-repository).

1. Run `npx decap-server`
2. In a different terminal pane or window run `npm run development`

Now any changes you publish in Decap CMS on your local machine will appear in your local repository.

**Note:** `src/cms/cms.tsx` automatically initializes the application with an override that sets
`local_backend: true`. This takes precedence over anything in `static/admin/config.yml`.

### Linting

To see which files are different, run `npm run lint`. To have automatically correct any lint errors
run `npm run lint:fix`.

### Testing

The tests can be run with `npm run test` or in watch mode with `npm run test:watch`. For convenience,
you can run `npm run validate` which will typecheck (`npm run typecheck`), lint (`npm run lint`), and run the tests.

Testing is done using [Jest](https://jestjs.io/) and configured across several files:

- `loadershim.ts`
- `jest.config.ts`
- `jest-preprocess.ts`
- `setup-test-env.ts`

This setup was adapted from the [Gatsby testing docs](https://www.gatsbyjs.com/docs/how-to/testing/unit-testing/).

## Technologies

This application uses the following technologies:

- [Decap CMS](https://decapcms.org/)
- [Gatsby](https://www.gatsbyjs.com/)
- [Jest](https://jestjs.io/)
- [NodeJS](https://nodejs.org/en)
- [React](https://react.dev/)
- [TypeScript](https://www.typescriptlang.org/)

## Workflow

### Site Admin

Site admins can sign in with Github through the root admin page at `example.org/admin`. Once they're signed in
they can create, update, or delete email templates. Example email templates could be "benefits expiring soon" or
"reminder to register."

Behind the scenes: Making changes to the email templates will change YAML files in the
`content/email-templates` folder of this repository. This causes the application to redeploy. During deployment
Gatsby will see the changes in `content/email-templates` and generate new and additional HTML pages based on them.

### End User

End users can visit the site and navigate to the template they're interested in. Once on an email template page
they can fill out their desired copy for the email and see a preview of it.

## Deployment

### File generation

At the end of the day, the deployed application is a set of static files (HTML, CSS, and JavaScript). These files
are generated by Gatsby in one of two ways: Either React code in `src/pages` or generated from YAML files in
`content` using templates found in `src/templates`. The code that combines these two sources to generate
files is `gatsby-node.ts`.
